{
  "always_run_in_app" : false,
  "icon" : {
    "color" : "red",
    "glyph" : "mobile-alt"
  },
  "name" : "è”é€š",
  "script" : "\/**\n * Author:LSP\n * Date:2023-04-15\n *\/\n\/\/ -------------------------------------------------------\n\/\/ æ˜¯å¦æ˜¯å¼€å‘ç¯å¢ƒï¼Œé…åˆæ‰‹æœºç«¯è°ƒè¯•ä½¿ç”¨ï¼Œæ­£å¼å‘å¸ƒè®¾ç½®ä¸ºfalse\nconst isDev = false;\nconst dependencyLSP = '20230511';\nconsole.log(`å½“å‰ç¯å¢ƒ ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ ${isDev ? 'DEV' : 'RELEASE'}`);\nconsole.log(`----------------------------------------`);\n\/\/ åˆ†æ”¯\nconst branch = 'v2';\n\/\/ ä»“åº“æ ¹ç›®å½•\nconst remoteGithubRoot = `https:\/\/raw.githubusercontent.com\/Enjoyee\/Scriptable\/${branch}`;\nconst remoteHomeLandRoot = `https:\/\/glimmerk.coding.net\/p\/Scriptable\/shared-depot\/source\/git\/raw\/${branch}`;\n\/\/ ä¾èµ–åŒ…ç›®å½•\nconst fm = FileManager.local();\nconst rootDir = fm.documentsDirectory();\nconst cacheDir = fm.joinPath(rootDir, 'LSP');\nconst dependencyFileName = isDev ? \"_LSP.js\" : `${cacheDir}\/_LSP.js`;\n\/\/ ä¸‹è½½ä¾èµ–åŒ…\nawait downloadLSPDependency();\n\/\/ -------------------------------------------------------\nif (typeof require === 'undefined') require = importModule\n\/\/ å¼•å…¥ç›¸å…³æ–¹æ³•\nconst { BaseWidget } = require(dependencyFileName);\n\n\/\/ @å®šä¹‰å°ç»„ä»¶\nclass Widget extends BaseWidget {\n\n  defaultPreference = {\n    fetchUrl: {\n      detail: `https:\/\/m.client.10010.com\/mobileserviceimportant\/home\/queryUserInfoSeven?version=iphone_c@10.0100&desmobiel=13232135179&showType=0`,\n    },\n    titleDayColor: '#000000',\n    titleNightColor: '#999999',\n    descDayColor: '#000000',\n    descNightColor: '#999999',\n    refreshTimeDayColor: '#000000',\n    refreshTimeNightColor: '#999999',\n  };\n\n  fee = {\n    title: 'ğŸ“± å‰©ä½™è¯è´¹ï¼š',\n    balance: 0,\n    unit: 'å…ƒ',\n  };\n\n  voice = {\n    title: 'â³ å‰©ä½™è¯­éŸ³ï¼š',\n    balance: 0,\n    percent: 0,\n    unit: 'åˆ†é’Ÿ',\n  };\n\n  flow = {\n    title: 'â›½ï¸ å‰©ä½™æµé‡ï¼š',\n    balance: 0,\n    percent: 0,\n    unit: 'MB',\n  };\n\n  getValueByKey = (key) => this.readWidgetSetting()[key] ?? '';\n\n  titleDayColor = () => this.getValueByKey('titleDayColor');\n  titleNightColor = () => this.getValueByKey('titleNightColor');\n\n  descDayColor = () => this.getValueByKey('descDayColor');\n  descNightColor = () => this.getValueByKey('descNightColor');\n\n  refreshTimeDayColor = () => this.getValueByKey('refreshTimeDayColor');\n  refreshTimeNightColor = () => this.getValueByKey('refreshTimeNightColor');\n\n  constructor(scriptName) {\n    super(scriptName);\n    this.reset = false;\n    this.defaultConfig.bgType = '3';\n    this.backgroundColor = '#FEFCF3,#0A2647';\n    this.cookie = this.getValueByKey('cookie');\n  }\n\n  async getAppViewOptions() {\n    return {\n      widgetProvider: {\n        small: true, \/\/ æ˜¯å¦æä¾›å°å·ç»„ä»¶\n        medium: false, \/\/ æ˜¯å¦æä¾›ä¸­å·ç»„ä»¶\n        large: false, \/\/ æ˜¯å¦æä¾›å¤§å·ç»„ä»¶\n      },\n      \/\/ é¢„è§ˆç•Œé¢çš„ç»„ä»¶è®¾ç½®item\n      settingItems: [\n        {\n          name: 'chinaUnicomCK',\n          label: 'è”é€šCookie',\n          type: 'cell',\n          icon: `${this.getRemoteRootPath()}\/img\/icon_10010.png`,\n          needLoading: true,\n          desc: this.getValueByKey('cookie')?.length > 0 ? 'å·²å¡«å†™' : 'æœªå¡«å†™'\n        },\n        {\n          name: 'otherSetting',\n          label: 'å…¶ä»–è®¾ç½®',\n          type: 'cell',\n          icon: 'https:\/\/cdnjson.com\/images\/2024\/02\/05\/settings.png',\n          needLoading: true,\n          childItems: [\n            {\n              items: [\n                {\n                  name: 'titleDayColor',\n                  label: 'æ ‡é¢˜æµ…è‰²é¢œè‰²',\n                  type: 'color',\n                  icon: { name: 'pencil.and.outline', color: '#3a86ff', },\n                  needLoading: false,\n                  default: this.titleDayColor(),\n                },\n                {\n                  name: 'titleNightColor',\n                  label: 'æ ‡é¢˜æ·±è‰²é¢œè‰²',\n                  type: 'color',\n                  icon: { name: 'square.and.pencil', color: '#3a0ca3', },\n                  needLoading: false,\n                  default: this.titleNightColor(),\n                },\n              ],\n            },\n            {\n              items: [\n                {\n                  name: 'descDayColor',\n                  label: 'å†…å®¹æµ…è‰²é¢œè‰²',\n                  type: 'color',\n                  icon: { name: 'pencil.and.outline', color: '#3a86ff', },\n                  needLoading: false,\n                  default: this.descDayColor(),\n                },\n                {\n                  name: 'descNightColor',\n                  label: 'å†…å®¹æ·±è‰²é¢œè‰²',\n                  type: 'color',\n                  icon: { name: 'square.and.pencil', color: '#3a0ca3', },\n                  needLoading: false,\n                  default: this.descNightColor(),\n                },\n              ],\n            },\n            {\n              items: [\n                {\n                  name: 'refreshTimeDayColor',\n                  label: 'åˆ·æ–°æ—¶é—´æµ…è‰²é¢œè‰²',\n                  type: 'color',\n                  icon: { name: 'pencil.and.outline', color: '#3a86ff', },\n                  needLoading: false,\n                  default: this.refreshTimeDayColor(),\n                },\n                {\n                  name: 'refreshTimeNightColor',\n                  label: 'åˆ·æ–°æ—¶é—´æ·±è‰²é¢œè‰²',\n                  type: 'color',\n                  icon: { name: 'square.and.pencil', color: '#3a0ca3', },\n                  needLoading: false,\n                  default: this.refreshTimeNightColor(),\n                },\n              ],\n            },\n          ]\n        },\n      ],\n      \/\/ cellç±»å‹çš„itemç‚¹å‡»å›è°ƒ\n      onItemClick: async (item) => {\n        const widgetSetting = this.readWidgetSetting();\n        let insertDesc = widgetSetting.phone?.length > 0 && widgetSetting.cookie?.length > 0 ? 'å·²å¡«å†™' : 'æœªå¡«å†™';\n        switch (item.name) {\n          case 'chinaUnicomCK':\n            let phone;\n            let ck;\n            await this.generateInputAlert({\n              title: 'ç™»å½•ä¿¡æ¯å¡«å†™',\n              message: 'è‡ªå·±æŠ“å–è”é€šå®¢æˆ·ç«¯appçš„cookieå¡«å…¥',\n              options: [\n                { hint: 'è¯·è¾“å…¥è”é€šå·ç ', value: widgetSetting?.phone ?? '' },\n                { hint: 'è¯·è¾“å…¥cookie', value: widgetSetting?.cookie ?? '' },\n              ]\n            }, async (inputArr) => {\n              this.reset = true;\n              phone = inputArr[0].value;\n              ck = inputArr[1].value;\n              \/\/ ä¿å­˜é…ç½®\n              widgetSetting['phone'] = phone;\n              widgetSetting['cookie'] = ck;\n            });\n            this.cookie = widgetSetting.cookie;\n            insertDesc = phone?.length > 0 && ck?.length > 0 ? 'å·²å¡«å†™' : 'æœªå¡«å†™';\n            this.writeWidgetSetting({ ...widgetSetting });\n            break;\n        }\n        return {\n          desc: { value: insertDesc },\n        };\n      },\n    };\n  }\n\n  async render() {\n    return await this.provideSmallWidget();\n  }\n\n  async provideSmallWidget() {\n    \/\/ ========================================\n    await this.loadDetailInfo();\n    const voiceBalance = this.voice.balance;\n    \/\/ ========================================\n    const widget = new ListWidget();\n    widget.setPadding(0, 0, 0, 0);\n    \/\/ ========================================\n    const widgetSize = this.getWidgetSize('å°å·');\n    let stack = widget.addStack();\n    let image = await this.getImageByUrl(`${this.getRemoteRootPath()}\/img\/bg_doraemon_1.png`);\n    stack.setPadding(4, 12, 0, 12);\n    stack.backgroundImage = image;\n    stack.size = new Size(widgetSize.width, widgetSize.height);\n    stack.layoutVertically();\n    stack.addSpacer();\n    \/\/ ========================================\n    const titleFont = Font.lightSystemFont(13);\n    const infoFont = Font.mediumSystemFont(16);\n    const titleTextColor = Color.dynamic(new Color(this.titleDayColor()), new Color(this.titleNightColor()));\n    const descTextColor = Color.dynamic(new Color(this.descDayColor()), new Color(this.descNightColor()));\n    const refreshTimeTextColor = Color.dynamic(new Color(this.refreshTimeDayColor()), new Color(this.refreshTimeNightColor()));\n    const descSpacer = 3;\n    const lineSpacer = 4;\n    const descLeftSpacer = 22;\n    \/\/ ========================================\n    let textSpan = stack.addText(`${this.fee.title}`);\n    textSpan.textColor = titleTextColor\n    textSpan.font = titleFont;\n    \/\/ \n    stack.addSpacer(descSpacer);\n    let displayStack = stack.addStack();\n    displayStack.centerAlignContent();\n    displayStack.addSpacer(descLeftSpacer);\n    textSpan = displayStack.addText(`${this.fee.balance}${this.fee.unit}`);\n    textSpan.textColor = descTextColor\n    textSpan.font = infoFont\n    displayStack.addSpacer();\n    \/\/ ========================================\n    stack.addSpacer(lineSpacer);\n    textSpan = stack.addText(`${this.voice.title}`);\n    textSpan.textColor = titleTextColor\n    textSpan.font = titleFont;\n    \/\/ \n    stack.addSpacer(descSpacer);\n    displayStack = stack.addStack();\n    displayStack.centerAlignContent();\n    displayStack.addSpacer(descLeftSpacer);\n    textSpan = displayStack.addText(`${voiceBalance}${this.voice.unit}`);\n    textSpan.textColor = descTextColor\n    textSpan.font = infoFont\n    displayStack.addSpacer();\n    \/\/ ========================================\n    stack.addSpacer(lineSpacer);\n    textSpan = stack.addText(`${this.flow.title}`);\n    textSpan.textColor = titleTextColor\n    textSpan.font = titleFont;\n    \/\/ \n    stack.addSpacer(descSpacer);\n    displayStack = stack.addStack();\n    displayStack.centerAlignContent();\n    displayStack.addSpacer(descLeftSpacer);\n    textSpan = displayStack.addText(`${this.flow.balance}${this.flow.unit}`);\n    textSpan.textColor = descTextColor\n    textSpan.font = infoFont\n    displayStack.addSpacer();\n    \/\/ ========================================\n\n    \/\/ ========================================\n    stack.addSpacer(6);\n    let btStack = stack.addStack();\n    btStack.centerAlignContent();\n    btStack.addSpacer(6);\n    image = this.getSFSymbol('goforward');\n    let imgSpan = btStack.addImage(image);\n    imgSpan.imageSize = new Size(9, 9);\n    imgSpan.tintColor = refreshTimeTextColor\n    btStack.addSpacer(4);\n    if (this.success) {\n      this.lastUpdate = this.getDateStr(new Date(), 'HH:mm');\n    }\n    textSpan = btStack.addText(`${this.getDateStr(new Date(), 'HH:mm')}`);\n    textSpan.textColor = refreshTimeTextColor\n    textSpan.font = Font.lightSystemFont(10);\n    btStack.addSpacer();\n    image = await this.getImageByUrl(`${this.getRemoteRootPath()}\/img\/ic_logo_10010.png`);\n    imgSpan = btStack.addImage(image);\n    imgSpan.imageSize = new Size(14, 14);\n    stack.addSpacer();\n    \/\/=================================\n    return widget;\n  }\n\n  \/\/ --------------------------NET START--------------------------\n  \/**\n   * æµé‡æ ¼å¼åŒ–\n   * @param {*} flow \n   * @returns \n   *\/\n  formatFlow = (flow) => {\n    const remain = flow \/ 1024;\n    if (remain < 1024) {\n      return { amount: remain.toFixed(2), unit: 'MB' };\n    }\n    return { amount: (remain \/ 1024).toFixed(2), unit: 'GB' };\n  }\n\n  \/**\n   * åŠ è½½æ˜ç»†\n   * @returns \n   *\/\n  loadDetailInfo = async () => {\n    const response = await this.httpGet(\n      this.defaultPreference.fetchUrl.detail,\n      {\n        useCache: this.reset ?? false,\n        dataSuccess: (res) => res.code == 'Y',\n        headers: {\n          'Host': 'm.client.10010.com',\n          'User-Agent': 'ChinaUnicom.x CFNetwork iOS\/16.3 unicom{version:iphone_c@10.0100}',\n          'cookie': this.cookie,\n        }\n      }\n    );\n    if (response?.code == 'Y') {\n      const { feeResource, voiceResource, flowResource } = response;\n      \/\/ è¯è´¹\n      this.fee = {\n        title: `ğŸ“± ${feeResource?.dynamicFeeTitle}ï¼š`,\n        balance: feeResource?.feePersent,\n        unit: feeResource?.newUnit,\n      };\n      \/\/ è¯­éŸ³\n      this.voice = {\n        title: `â³ ${voiceResource?.dynamicVoiceTitle}ï¼š`,\n        balance: voiceResource?.voicePersent,\n        percent: 0,\n        unit: voiceResource?.newUnit,\n      };\n      \/\/ æµé‡\n      this.flow = {\n        title: `â›½ï¸ ${flowResource?.dynamicFlowTitle}ï¼š`,\n        balance: flowResource?.flowPersent,\n        percent: 0,\n        unit: flowResource?.newUnit,\n      };\n      console.log(`è¯è´¹ï¼š`);\n      console.log(JSON.stringify(this.fee, null, 2));\n      console.log(`è¯­éŸ³ï¼š`);\n      console.log(JSON.stringify(this.voice, null, 2));\n      console.log(`æµé‡ï¼š`);\n      console.log(JSON.stringify(this.flow, null, 2));\n    } else {\n      this.notify('è”é€šå°ç»„ä»¶', `å¯èƒ½cookieå¤±æ•ˆäº†~`);\n    }\n  }\n\n  \/\/ --------------------------NET END--------------------------\n}\n\nawait new Widget(Script.name()).run();\n\n\n\/\/ =================================================================================\n\/\/ =================================================================================\nasync function downloadLSPDependency() {\n  let fm = FileManager.local();\n  const fileName = fm.joinPath(fm.documentsDirectory(), `LSP\/${Script.name()}\/settings.json`);\n  const fileExists = fm.fileExists(fileName);\n  let cacheString = '{}';\n  if (fileExists) {\n    cacheString = fm.readString(fileName);\n  }\n  const use_github = JSON.parse(cacheString)['use_github'];\n  const dependencyURL = `${use_github ? remoteGithubRoot : remoteHomeLandRoot}\/_LSP.js`;\n  const update = needUpdateDependency();\n  if (isDev) {\n    const iCloudPath = FileManager.iCloud().documentsDirectory();\n    const localIcloudDependencyExit = fm.isFileStoredIniCloud(`${iCloudPath}\/_LSP.js`);\n    const localDependencyExit = fm.fileExists(`${rootDir}\/_LSP.js`);\n    const fileExist = localIcloudDependencyExit || localDependencyExit;\n    console.log(`ğŸš€ DEVå¼€å‘ä¾èµ–æ–‡ä»¶${fileExist ? 'å·²å­˜åœ¨ âœ…' : 'ä¸å­˜åœ¨ ğŸš«'}`);\n    if (!fileExist || update) {\n      console.log(`ğŸ¤– DEV å¼€å§‹${update ? 'æ›´æ–°' + dependencyLSP : 'ä¸‹è½½'}ä¾èµ–~`);\n      keySave('VERSION', dependencyLSP);\n      await downloadFile2Scriptable('_LSP', dependencyURL);\n    }\n    return;\n  }\n\n  \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n  console.log(`----------------------------------------`);\n  const remoteDependencyExit = fm.fileExists(`${cacheDir}\/_LSP.js`);\n  console.log(`ğŸš€ RELEASEä¾èµ–æ–‡ä»¶${remoteDependencyExit ? 'å·²å­˜åœ¨ âœ…' : 'ä¸å­˜åœ¨ ğŸš«'}`);\n  \/\/ ------------------------------\n  if (!remoteDependencyExit || update) { \/\/ ä¸‹è½½ä¾èµ–\n    \/\/ åˆ›å»ºæ ¹ç›®å½•\n    if (!fm.fileExists(cacheDir)) {\n      fm.createDirectory(cacheDir, true);\n    }\n    \/\/ ä¸‹è½½\n    console.log(`ğŸ¤– RELEASEå¼€å§‹${update ? 'æ›´æ–°' : 'ä¸‹è½½'}ä¾èµ–~`);\n    console.log(`----------------------------------------`);\n    const req = new Request(dependencyURL);\n    const moduleJs = await req.load();\n    if (moduleJs) {\n      fm.write(fm.joinPath(cacheDir, '\/_LSP.js'), moduleJs);\n      keySave('VERSION', dependencyLSP);\n      console.log('âœ… LSPè¿œç¨‹ä¾èµ–ç¯å¢ƒä¸‹è½½æˆåŠŸï¼');\n      console.log(`----------------------------------------`);\n    } else {\n      console.error('ğŸš« è·å–ä¾èµ–ç¯å¢ƒè„šæœ¬å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');\n      console.log(`----------------------------------------`);\n    }\n  }\n}\n\n\/**\n * è·å–ä¿å­˜çš„æ–‡ä»¶å\n * @param {*} fileName \n * @returns \n *\/\nfunction getSaveFileName(fileName) {\n  const hasSuffix = fileName.lastIndexOf(\".\") + 1;\n  return !hasSuffix ? `${fileName}.js` : fileName;\n};\n\n\/**\n * ä¿å­˜æ–‡ä»¶åˆ°Scriptableè½¯ä»¶ç›®å½•ï¼Œappå¯çœ‹åˆ°\n * @param {*} fileName \n * @param {*} content \n * @returns \n *\/\nfunction saveFile2Scriptable(fileName, content) {\n  try {\n    const fm = FileManager.iCloud();\n    let fileSimpleName = getSaveFileName(fileName);\n    const filePath = fm.joinPath(fm.documentsDirectory(), fileSimpleName);\n    fm.writeString(filePath, content);\n    return true;\n  } catch (error) {\n    return false;\n  }\n};\n\n\/**\n * ä¸‹è½½jsæ–‡ä»¶åˆ°Scriptableè½¯ä»¶ç›®å½•\n * @param {*} moduleName åç§° \n * @param {*} url åœ¨çº¿åœ°å€ \n * @returns \n *\/\nasync function downloadFile2Scriptable(moduleName, url) {\n  const req = new Request(url);\n  const content = await req.loadString();\n  return saveFile2Scriptable(`${moduleName}`, content);\n};\n\n\/**\n * æ˜¯å¦éœ€è¦æ›´æ–°ä¾èµ–ç‰ˆæœ¬\n *\/\nfunction needUpdateDependency() {\n  return dependencyLSP != keyGet('VERSION');\n};\n\nfunction keySave(cacheKey, cache) {\n  if (cache) {\n    Keychain.set(Script.name() + cacheKey, cache);\n  }\n}\n\nfunction keyGet(cacheKey, defaultValue = '') {\n  if (Keychain.contains(Script.name() + cacheKey)) {\n    return Keychain.get(Script.name() + cacheKey);\n  } else {\n    return defaultValue;\n  }\n}\n\/\/ =================================================================================\n\/\/ =================================================================================",
  "share_sheet_inputs" : [

  ]
}