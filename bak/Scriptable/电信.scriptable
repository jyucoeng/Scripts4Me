{
  "always_run_in_app" : false,
  "icon" : {
    "color" : "blue",
    "glyph" : "mobile-alt"
  },
  "name" : "ç”µä¿¡",
  "script" : "\/**\n * Author:LSP\n * Date:2024-04-19\n *\/\n\/\/ -------------------------------------------------------\n\/\/ æ˜¯å¦æ˜¯å¼€å‘ç¯å¢ƒï¼Œé…åˆæ‰‹æœºç«¯è°ƒè¯•ä½¿ç”¨ï¼Œæ­£å¼å‘å¸ƒè®¾ç½®ä¸ºfalse\nconst isDev = false;\nconst dependencyLSP = '20240419_1';\nconsole.log(`å½“å‰ç¯å¢ƒ ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ğŸ‘‰ ${isDev ? 'DEV' : 'RELEASE'}`);\nconsole.log(`----------------------------------------`);\n\/\/ åˆ†æ”¯\nconst branch = 'v2';\n\/\/ ä»“åº“æ ¹ç›®å½•\nconst remoteGithubRoot = `https:\/\/raw.githubusercontent.com\/Enjoyee\/Scriptable\/${branch}`;\nconst remoteHomeLandRoot = `https:\/\/glimmerk.coding.net\/p\/Scriptable\/shared-depot\/source\/git\/raw\/${branch}`;\n\/\/ ä¾èµ–åŒ…ç›®å½•\nconst fm = FileManager.local();\nconst rootDir = fm.documentsDirectory();\nconst cacheDir = fm.joinPath(rootDir, 'LSP');\nconst dependencyFileName = isDev ? \"_LSP.js\" : `${cacheDir}\/_LSP.js`;\n\/\/ ä¸‹è½½ä¾èµ–åŒ…\nawait downloadLSPDependency();\n\/\/ -------------------------------------------------------\nif (typeof require === 'undefined') require = importModule\n\/\/ å¼•å…¥ç›¸å…³æ–¹æ³•\nconst { BaseWidget } = require(dependencyFileName);\n\n\/\/ @å®šä¹‰å°ç»„ä»¶\nclass Widget extends BaseWidget {\n\n  defaultPreference = {\n    cache_key_detail: 'detail',\n    cache_key_balance: 'balance',\n    fetchUrl: {\n      home: 'https:\/\/e.dlife.cn\/wap\/mine\/showIndex.do#\/',\n      detail: 'https:\/\/e.dlife.cn\/user\/package_detail.do',\n      balance: 'https:\/\/e.dlife.cn\/user\/balance.do',\n    },\n    titleDayColor: '#000000',\n    titleNightColor: '#278da2',\n    descDayColor: '#000000',\n    descNightColor: '#278da2',\n    refreshTimeDayColor: '#000000',\n    refreshTimeNightColor: '#278da2',\n  };\n\n  fee = {\n    title: 'ğŸ“± å‰©ä½™è¯è´¹ï¼š',\n    balance: 0,\n    unit: 'å…ƒ',\n  };\n\n  voice = {\n    title: 'â³ å‰©ä½™è¯­éŸ³ï¼š',\n    balance: 0,\n    percent: 0,\n    unit: 'åˆ†é’Ÿ',\n  };\n\n  flow = {\n    title: 'â›½ï¸ å‰©ä½™æµé‡ï¼š',\n    balance: 0,\n    percent: 0,\n    unit: 'MB',\n  };\n\n  getValueByKey = (key) => this.readWidgetSetting()[key] ?? this.defaultPreference[key];\n\n  titleDayColor = () => this.getValueByKey('titleDayColor');\n  titleNightColor = () => this.getValueByKey('titleNightColor');\n\n  descDayColor = () => this.getValueByKey('descDayColor');\n  descNightColor = () => this.getValueByKey('descNightColor');\n\n  refreshTimeDayColor = () => this.getValueByKey('refreshTimeDayColor');\n  refreshTimeNightColor = () => this.getValueByKey('refreshTimeNightColor');\n\n  constructor(scriptName) {\n    super(scriptName);\n    this.reset = false;\n    this.defaultConfig.bgType = '3';\n    this.backgroundColor = '#FEFCF3,#0A2647';\n    this.cookie = this.getValueByKey('cookie');\n  }\n\n  async getAppViewOptions() {\n    return {\n      widgetProvider: {\n        small: true, \/\/ æ˜¯å¦æä¾›å°å·ç»„ä»¶\n        medium: false, \/\/ æ˜¯å¦æä¾›ä¸­å·ç»„ä»¶\n        large: false, \/\/ æ˜¯å¦æä¾›å¤§å·ç»„ä»¶\n      },\n      \/\/ é¢„è§ˆç•Œé¢çš„ç»„ä»¶è®¾ç½®item\n      settingItems: [\n        {\n          name: 'chinaTelecomCK',\n          label: 'å¤©ç¿¼ä¿¡æ¯',\n          type: 'cell',\n          icon: `${this.getRemoteRootPath()}\/img\/icon_10000.png`,\n          needLoading: true,\n          desc: this.getValueByKey('loginMiddle')?.length > 0 ? 'å·²å¡«å†™' : 'æœªå¡«å†™'\n        },\n        {\n          name: 'filterOrientateFlow',\n          label: 'è¿‡æ»¤å®šå‘æµé‡',\n          type: 'switch',\n          icon: { name: 'bag.fill', color: '#F14A16', },\n          needLoading: false,\n          default: false\n        },\n        {\n          name: 'showUsedFlow',\n          label: 'æ˜¾ç¤ºå·²ä½¿ç”¨æµé‡',\n          type: 'switch',\n          icon: { name: 'archivebox.fill', color: '#ECA97A', },\n          needLoading: false,\n          default: false\n        },\n        {\n          name: 'otherSetting',\n          label: 'å…¶ä»–è®¾ç½®',\n          type: 'cell',\n          icon: 'https:\/\/cdnjson.com\/images\/2024\/02\/05\/settings.png',\n          needLoading: true,\n          childItems: [\n            {\n              items: [\n                {\n                  name: 'titleDayColor',\n                  label: 'æ ‡é¢˜æµ…è‰²é¢œè‰²',\n                  type: 'color',\n                  icon: { name: 'pencil.and.outline', color: '#3a86ff', },\n                  needLoading: false,\n                  default: this.titleDayColor(),\n                },\n                {\n                  name: 'titleNightColor',\n                  label: 'æ ‡é¢˜æ·±è‰²é¢œè‰²',\n                  type: 'color',\n                  icon: { name: 'square.and.pencil', color: '#3a0ca3', },\n                  needLoading: false,\n                  default: this.titleNightColor(),\n                },\n              ],\n            },\n            {\n              items: [\n                {\n                  name: 'descDayColor',\n                  label: 'å†…å®¹æµ…è‰²é¢œè‰²',\n                  type: 'color',\n                  icon: { name: 'pencil.and.outline', color: '#3a86ff', },\n                  needLoading: false,\n                  default: this.descDayColor(),\n                },\n                {\n                  name: 'descNightColor',\n                  label: 'å†…å®¹æ·±è‰²é¢œè‰²',\n                  type: 'color',\n                  icon: { name: 'square.and.pencil', color: '#3a0ca3', },\n                  needLoading: false,\n                  default: this.descNightColor(),\n                },\n              ],\n            },\n            {\n              items: [\n                {\n                  name: 'refreshTimeDayColor',\n                  label: 'åˆ·æ–°æ—¶é—´æµ…è‰²é¢œè‰²',\n                  type: 'color',\n                  icon: { name: 'pencil.and.outline', color: '#3a86ff', },\n                  needLoading: false,\n                  default: this.refreshTimeDayColor(),\n                },\n                {\n                  name: 'refreshTimeNightColor',\n                  label: 'åˆ·æ–°æ—¶é—´æ·±è‰²é¢œè‰²',\n                  type: 'color',\n                  icon: { name: 'square.and.pencil', color: '#3a0ca3', },\n                  needLoading: false,\n                  default: this.refreshTimeNightColor(),\n                },\n              ],\n            },\n          ]\n        },\n      ],\n      \/\/ cellç±»å‹çš„itemç‚¹å‡»å›è°ƒ\n      onItemClick: async (item) => {\n        let insertDesc;\n        const widgetSetting = this.readWidgetSetting();\n        switch (item.name) {\n          case 'chinaTelecomCK':\n            let loginMiddle;\n            let selectIndex = await this.generateAlert('ç™»å½•ä¿¡æ¯å¡«å†™', '1.å¤åˆ¶é“¾æ¥è¿›è¡Œç½‘é¡µç™»å½•\\n2.æŠ“å–åŒ…å«loginMiddle.doé“¾æ¥è¿›è¡Œå¡«å…¥', ['å¤åˆ¶åœ°å€', 'å¡«å…¥é“¾æ¥']);\n            if (selectIndex == 0) {\n              Pasteboard.copy(this.defaultPreference.fetchUrl.home);\n              await this.generateAlert('æç¤º', 'ç™»å½•é“¾æ¥å·²å¤åˆ¶ï¼Œè¯·è‡ªè¡Œç½‘é¡µç™»å½•æŠ“åŒ…', [\"å¥½çš„\"])\n            } else {\n              await this.generateInputAlert({\n                title: 'ç™»å½•ä¿¡æ¯é“¾æ¥å¡«å†™',\n                message: 'å¡«å…¥æŠ“å–åŒ…å«loginMiddle.doçš„é“¾æ¥',\n                options: [\n                  { hint: 'è¯·è¾“å…¥é“¾æ¥', value: '' },\n                ]\n              }, async (inputArr) => {\n                this.reset = true;\n                loginMiddle = inputArr[0].value;\n                \/\/ ä¿å­˜é…ç½®\n                widgetSetting['loginMiddle'] = loginMiddle;\n              });\n            }\n            insertDesc = loginMiddle?.length > 0 ? 'å·²å¡«å†™' : 'æœªå¡«å†™';\n            this.writeWidgetSetting({ ...widgetSetting });\n            break;\n        }\n        return {\n          desc: { value: insertDesc },\n        };\n      },\n    };\n  }\n\n  async render({ widgetSetting }) {\n    return await this.provideSmallWidget(widgetSetting);\n  }\n\n  async provideSmallWidget(widgetSetting) {\n    \/\/ ========================================\n    let loginMiddle = widgetSetting.loginMiddle;\n    if (loginMiddle) {\n      console.log('è·å–åŠ è½½ck...');\n      const req = new Request(widgetSetting.loginMiddle);\n      req.credentials = 'include';\n      await req.load();\n      const cookieResArr = req.response.cookies;\n      const ckArr = cookieResArr?.map(item => `${item.name}=${item.value}`);\n      const ck = ckArr.join(';')\n      widgetSetting['cookie'] = ck;\n      this.cookie = ck;\n      console.log(`è·å–åˆ°çš„ckï¼š${ck}`);\n    } else {\n      console.error('âŒâŒâŒâŒâŒæœªé…ç½®ç™»å½•é“¾æ¥âŒâŒâŒâŒâŒ');\n    }\n    console.log(`=======================================`);\n\n    \/\/ ========================================\n    await this.loadMoneyBalance();\n    await this.loadDetailInfo(widgetSetting);\n    const voiceBalance = this.voice.balance;\n    \/\/ ========================================\n    const widget = new ListWidget();\n    widget.setPadding(0, 0, 0, 0);\n    \/\/ ========================================\n    const widgetSize = this.getWidgetSize('å°å·');\n    let stack = widget.addStack();\n    let image = await this.getImageByUrl(`${this.getRemoteRootPath()}\/img\/bg_doraemon_1.png`);\n    stack.setPadding(4, 12, 0, 12);\n    stack.backgroundImage = image;\n    stack.size = new Size(widgetSize.width, widgetSize.height);\n    stack.layoutVertically();\n    stack.addSpacer();\n    \/\/ ========================================\n    const titleFont = Font.lightSystemFont(13);\n    const infoFont = Font.mediumSystemFont(16);\n    const titleTextColor = Color.dynamic(new Color(this.titleDayColor()), new Color(this.titleNightColor()));\n    const descTextColor = Color.dynamic(new Color(this.descDayColor()), new Color(this.descNightColor()));\n    const refreshTimeTextColor = Color.dynamic(new Color(this.refreshTimeDayColor()), new Color(this.refreshTimeNightColor()));\n    const descSpacer = 3;\n    const lineSpacer = 4;\n    const descLeftSpacer = 22;\n    \/\/ ========================================\n    let textSpan = stack.addText(`${this.fee.title}`);\n    textSpan.textColor = titleTextColor;\n    textSpan.font = titleFont;\n    \/\/ \n    stack.addSpacer(descSpacer);\n    let displayStack = stack.addStack();\n    displayStack.centerAlignContent();\n    displayStack.addSpacer(descLeftSpacer);\n    textSpan = displayStack.addText(`${this.fee.balance}${this.fee.unit}`);\n    textSpan.textColor = descTextColor;\n    textSpan.font = infoFont;\n    displayStack.addSpacer();\n    \/\/ ========================================\n    stack.addSpacer(lineSpacer);\n    textSpan = stack.addText(`${this.voice.title} `);\n    textSpan.textColor = titleTextColor;\n    textSpan.font = titleFont;\n    \/\/ \n    stack.addSpacer(descSpacer);\n    displayStack = stack.addStack();\n    displayStack.centerAlignContent();\n    displayStack.addSpacer(descLeftSpacer);\n    textSpan = displayStack.addText(`${voiceBalance}${this.voice.unit}`);\n    textSpan.textColor = descTextColor;\n    textSpan.font = infoFont;\n    displayStack.addSpacer();\n    \/\/ ========================================\n    stack.addSpacer(lineSpacer);\n    textSpan = stack.addText(`${this.flow.title} `);\n    textSpan.textColor = titleTextColor;\n    textSpan.font = titleFont;\n    \/\/ \n    stack.addSpacer(descSpacer);\n    displayStack = stack.addStack();\n    displayStack.centerAlignContent();\n    displayStack.addSpacer(descLeftSpacer);\n    textSpan = displayStack.addText(`${this.flow.balance}${this.flow.unit}`);\n    textSpan.textColor = descTextColor;\n    textSpan.font = infoFont;\n    displayStack.addSpacer();\n    \/\/ ========================================\n\n    \/\/ ========================================\n    stack.addSpacer(6);\n    let btStack = stack.addStack();\n    btStack.centerAlignContent();\n    btStack.addSpacer(6);\n    image = this.getSFSymbol('goforward');\n    let imgSpan = btStack.addImage(image);\n    imgSpan.imageSize = new Size(9, 9);\n    imgSpan.tintColor = refreshTimeTextColor;\n    btStack.addSpacer(4);\n    if (this.success) {\n      this.lastUpdate = this.getDateStr(new Date(), 'HH:mm:ss');\n    }\n    textSpan = btStack.addText(`${this.getDateStr(new Date(), 'HH:mm:ss')} `);\n    textSpan.textColor = refreshTimeTextColor;\n    textSpan.font = Font.lightSystemFont(10);\n    btStack.addSpacer();\n    image = await this.getImageByUrl(`${this.getRemoteRootPath()}\/img\/ic_logo_10000.jpg`);\n    imgSpan = btStack.addImage(image);\n    imgSpan.imageSize = new Size(14, 14);\n    stack.addSpacer();\n    \/\/=================================\n    return widget;\n  }\n\n  \/\/ --------------------------NET START--------------------------\n  bodyText2Response = async (webview, cacheKey) => {\n    const widgetSetting = this.readWidgetSetting();\n    const text = await webview.evaluateJavaScript(\"document.body.innerText\");\n    const ck = await webview.evaluateJavaScript(\"document.cookie\");\n    console.log(`CK:${ck} `);\n    let RES;\n    try {\n      this.success = true;\n      RES = JSON.parse(text);\n      widgetSetting['loginRes'] = 'login';\n      this.useFileManager().writeJSONCache(cacheKey, RES);\n    } catch (error) {\n      this.success = false;\n      widgetSetting['loginRes'] = '';\n      console.error(`åŠ è½½å‡ºé”™ï¼š${text} `);\n    }\n    this.writeWidgetSetting(widgetSetting);\n    return RES;\n  }\n\n  \/**\n   * åŠ è½½è´¦æˆ·ä½™é¢\n   *\/\n  loadMoneyBalance = async () => {\n    const response = await this.httpGet(\n      this.defaultPreference.fetchUrl.balance,\n      {\n        useCache: this.reset ?? false,\n        dataSuccess: (res) => res.serviceResultCode == '0',\n        headers: {\n          'cookie': this.cookie\n        }\n      }\n    );\n    this.fee.balance = response == undefined || response['serviceResultCode'] == 0 ? parseFloat(parseInt(response?.totalBalanceAvailable || 0) \/ 100).toFixed(2) : 'NAN';\n  }\n\n  \/**\n   * æµé‡æ ¼å¼åŒ–\n   * @param {*} flow \n   * @returns \n   *\/\n  formatFlow = (flow) => {\n    const remain = flow \/ 1024;\n    if (remain < 1024) {\n      return { amount: remain.toFixed(2), unit: 'MB' };\n    }\n    return { amount: (remain \/ 1024).toFixed(2), unit: 'GB' };\n  }\n\n  \/**\n   * åŠ è½½æ˜ç»†\n   * @returns \n   *\/\n  loadDetailInfo = async (widgetSetting) => {\n    const { filterOrientateFlow, showUsedFlow } = widgetSetting;\n    const response = await this.httpGet(\n      this.defaultPreference.fetchUrl.detail,\n      {\n        useCache: this.reset ?? false,\n        dataSuccess: (res) => res.paraFieldResult == 'SUCCESS',\n        headers: {\n          'cookie': this.cookie\n        }\n      }\n    );\n    \/\/ æ€»æµé‡\n    let totalFlowAmount = 0;\n    \/\/ å‰©ä½™æµé‡\n    let totalBalanceFlowAmount = 0;\n    \/\/ å·²ç”¨æµé‡\n    let totalUsedFlowAmount = 0;\n    \/\/ æ€»è¯­éŸ³\n    let totalVoiceAmount = 0;\n    \/\/ å‰©ä½™è¯­éŸ³\n    let totalBalanceVoiceAmount = 0;\n    \/\/ è¯­éŸ³\n    if (response?.voiceAmount && response?.voiceBalance) {\n      totalVoiceAmount = response.voiceAmount;\n      totalBalanceVoiceAmount = response.voiceBalance;\n    }\n    \/\/ æµé‡&è¯­éŸ³\n    let isUnlimitedFlow = false;\n    response?.items?.forEach((data) => {\n      if (data.offerType !== 19) {\n        data.items?.forEach((item) => {\n          if (item.unitTypeId == 3) {\n            if (!(item.usageAmount == 0 && item.balanceAmount == 0)) {\n              let ratableResourcename = item.ratableResourcename;\n              let ratableAmount = item.ratableAmount;\n              let balanceAmount = item.balanceAmount;\n              let usedAmount = ratableAmount - balanceAmount;\n              console.log(`å¥—é¤åç§°ï¼šÂ«${ratableResourcename}Â»`);\n              console.log(`å¥—é¤æ€»æµé‡ï¼š${ratableAmount} MB`);\n              console.log(`å¥—é¤å‰©ä½™æµé‡ï¼š${balanceAmount} MB`);\n              console.log(`å¥—é¤å·²ç”¨æµé‡ï¼š${usedAmount} MB`);\n              console.log(`================================= `);\n              if (filterOrientateFlow && ratableResourcename.search('å®šå‘') != -1 || balanceAmount == '999999999999') {\n                ratableAmount = 0;\n                balanceAmount = 0;\n              }\n              totalFlowAmount += parseFloat(ratableAmount);\n              totalBalanceFlowAmount += parseFloat(balanceAmount);\n            }\n            totalUsedFlowAmount += parseFloat(item.usageAmount);\n            if (showUsedFlow) {\n              this.flow.title = 'â›½ï¸ æµé‡å·²ç”¨ï¼š';\n            }\n            if (data.offerType == 21 && item.ratableAmount == '0') {\n              \/\/ æ— é™æµé‡ç”¨æˆ·\n              isUnlimitedFlow = true;\n            }\n          } else if (!response.voiceBalance && item.unitTypeId == 1) {\n            totalVoiceAmount += parseInt(item.ratableAmount);\n            totalBalanceVoiceAmount += parseInt(item.balanceAmount);\n          }\n        });\n      }\n    });\n    const totalFlowObj = this.formatFlow(totalFlowAmount);\n    const totalBalanceFlowObj = this.formatFlow(totalBalanceFlowAmount);\n    const totalUsedFlowObj = this.formatFlow(totalUsedFlowAmount);\n    const finalBalanceFlowObj = showUsedFlow ? totalUsedFlowObj : totalBalanceFlowObj;\n    console.log(`æ€»æµé‡ï¼š${totalFlowObj.amount}${totalFlowObj.unit} `);\n    console.log(`å‰©ä½™æµé‡ï¼š${totalBalanceFlowObj.amount}${totalBalanceFlowObj.unit} `);\n    console.log(`å·²ä½¿ç”¨æµé‡ï¼š${totalUsedFlowObj.amount}${totalUsedFlowObj.unit} `);\n    console.log(`æ€»è¯­éŸ³ï¼š${totalVoiceAmount}${this.voice.unit} `);\n    console.log(`å‰©ä½™è¯­éŸ³ï¼š${totalBalanceVoiceAmount}${this.voice.unit} `);\n    console.log(`================================= `);\n    \/\/ è®¾ç½®æµé‡\n    this.flow.percent = ((totalBalanceFlowAmount \/ (totalFlowAmount || 1)) * 100).toFixed(2);\n    this.flow.balance = finalBalanceFlowObj.amount;\n    this.flow.unit = finalBalanceFlowObj.unit;\n    if (isUnlimitedFlow) {\n      const usageAmountObj = this.formatFlow(totalUsedFlowAmount);\n      this.flow.title = 'â›½ï¸ æµé‡å·²ç”¨ï¼š';\n      this.flow.balance = usageAmountObj.amount;\n      this.flow.unit = usageAmountObj.unit;\n    }\n    \/\/ è®¾ç½®è¯­éŸ³\n    this.voice.percent = ((totalBalanceVoiceAmount \/ (totalVoiceAmount || 1)) * 100).toFixed(2);\n    this.voice.balance = totalBalanceVoiceAmount;\n  }\n\n  \/\/ --------------------------NET END--------------------------\n}\n\nawait new Widget(Script.name()).run();\n\n\n\/\/ =================================================================================\n\/\/ =================================================================================\nasync function downloadLSPDependency() {\n  let fm = FileManager.local();\n  const fileName = fm.joinPath(fm.documentsDirectory(), `LSP\/${Script.name()}\/settings.json`);\n  const fileExists = fm.fileExists(fileName);\n  let cacheString = '{}';\n  if (fileExists) {\n    cacheString = fm.readString(fileName);\n  }\n  const use_github = JSON.parse(cacheString)['use_github'];\n  const dependencyURL = `${use_github ? remoteGithubRoot : remoteHomeLandRoot}\/_LSP.js`;\n  const update = needUpdateDependency();\n  if (isDev) {\n    const iCloudPath = FileManager.iCloud().documentsDirectory();\n    const localIcloudDependencyExit = fm.isFileStoredIniCloud(`${iCloudPath}\/_LSP.js`);\n    const localDependencyExit = fm.fileExists(`${rootDir}\/_LSP.js`);\n    const fileExist = localIcloudDependencyExit || localDependencyExit;\n    console.log(`ğŸš€ DEVå¼€å‘ä¾èµ–æ–‡ä»¶${fileExist ? 'å·²å­˜åœ¨ âœ…' : 'ä¸å­˜åœ¨ ğŸš«'}`);\n    if (!fileExist || update) {\n      console.log(`ğŸ¤– DEV å¼€å§‹${update ? 'æ›´æ–°' + dependencyLSP : 'ä¸‹è½½'}ä¾èµ–~`);\n      keySave('VERSION', dependencyLSP);\n      await downloadFile2Scriptable('_LSP', dependencyURL);\n    }\n    return;\n  }\n\n  \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n  console.log(`----------------------------------------`);\n  const remoteDependencyExit = fm.fileExists(`${cacheDir}\/_LSP.js`);\n  console.log(`ğŸš€ RELEASEä¾èµ–æ–‡ä»¶${remoteDependencyExit ? 'å·²å­˜åœ¨ âœ…' : 'ä¸å­˜åœ¨ ğŸš«'}`);\n  \/\/ ------------------------------\n  if (!remoteDependencyExit || update) { \/\/ ä¸‹è½½ä¾èµ–\n    \/\/ åˆ›å»ºæ ¹ç›®å½•\n    if (!fm.fileExists(cacheDir)) {\n      fm.createDirectory(cacheDir, true);\n    }\n    \/\/ ä¸‹è½½\n    console.log(`ğŸ¤– RELEASEå¼€å§‹${update ? 'æ›´æ–°' : 'ä¸‹è½½'}ä¾èµ–~`);\n    console.log(`----------------------------------------`);\n    const req = new Request(dependencyURL);\n    const moduleJs = await req.load();\n    if (moduleJs) {\n      fm.write(fm.joinPath(cacheDir, '\/_LSP.js'), moduleJs);\n      keySave('VERSION', dependencyLSP);\n      console.log('âœ… LSPè¿œç¨‹ä¾èµ–ç¯å¢ƒä¸‹è½½æˆåŠŸï¼');\n      console.log(`----------------------------------------`);\n    } else {\n      console.error('ğŸš« è·å–ä¾èµ–ç¯å¢ƒè„šæœ¬å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');\n      console.log(`----------------------------------------`);\n    }\n  }\n}\n\n\/**\n * è·å–ä¿å­˜çš„æ–‡ä»¶å\n * @param {*} fileName \n * @returns \n *\/\nfunction getSaveFileName(fileName) {\n  const hasSuffix = fileName.lastIndexOf(\".\") + 1;\n  return !hasSuffix ? `${fileName}.js` : fileName;\n};\n\n\/**\n * ä¿å­˜æ–‡ä»¶åˆ°Scriptableè½¯ä»¶ç›®å½•ï¼Œappå¯çœ‹åˆ°\n * @param {*} fileName \n * @param {*} content \n * @returns \n *\/\nfunction saveFile2Scriptable(fileName, content) {\n  try {\n    const fm = FileManager.iCloud();\n    let fileSimpleName = getSaveFileName(fileName);\n    const filePath = fm.joinPath(fm.documentsDirectory(), fileSimpleName);\n    fm.writeString(filePath, content);\n    return true;\n  } catch (error) {\n    return false;\n  }\n};\n\n\/**\n * ä¸‹è½½jsæ–‡ä»¶åˆ°Scriptableè½¯ä»¶ç›®å½•\n * @param {*} moduleName åç§° \n * @param {*} url åœ¨çº¿åœ°å€ \n * @returns \n *\/\nasync function downloadFile2Scriptable(moduleName, url) {\n  const req = new Request(url);\n  const content = await req.loadString();\n  return saveFile2Scriptable(`${moduleName}`, content);\n};\n\n\/**\n * æ˜¯å¦éœ€è¦æ›´æ–°ä¾èµ–ç‰ˆæœ¬\n *\/\nfunction needUpdateDependency() {\n  return dependencyLSP != keyGet('VERSION');\n};\n\nfunction keySave(cacheKey, cache) {\n  if (cache) {\n    Keychain.set(Script.name() + cacheKey, cache);\n  }\n}\n\nfunction keyGet(cacheKey, defaultValue = '') {\n  if (Keychain.contains(Script.name() + cacheKey)) {\n    return Keychain.get(Script.name() + cacheKey);\n  } else {\n    return defaultValue;\n  }\n}\n\/\/ =================================================================================\n\/\/ =================================================================================",
  "share_sheet_inputs" : [

  ]
}